{% extends 'base.html' %}
{% block title %}User Management{% endblock %}

{% block body %}
        <div class="container">
        <table class="table table-hover table-condensed">
            <thead>
                <tr>
                    <td class="col-xs-2"><strong>Username</strong></td>
                    <td class="col-xs-2"><strong>Last Login</strong></td>
                    <td class="col-xs-2" style="text-align: center;"><strong>Active</strong></td>
                    <td class="col-xs-2" style="text-align: center;"><strong>Staff</strong></td>
                    <td class="col-xs-2" style="text-align: center;"><strong>Superuser</strong></td>
                    <td class="col-xs-1" style="text-align: center;"><strong>Update</strong></td>
                    <td class="col-xs-1" style="text-align: center;"><strong>Delete</strong></td>
                </tr>
            </thead>
            {% for user in users %}
                <form method="post" action="{% url 'user_update' user.id %}">
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.last_login }}</td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="is_active" {% if user.is_active %}checked{% endif %}>
                        </td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="is_staff" {% if user.is_staff %}checked{% endif %}>
                        </td>
                        <td style="text-align: center;">
                            <input type="checkbox" name="is_superuser" {% if user.is_superuser %}checked{% endif %}>
                        </td>
                        <td style="text-align: center;">
                            {% csrf_token %}
                            <button class="btn btn-primary btn-xs" type="submit">
                                <i class="fa fa-refresh"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <a href="#" class="btn btn-danger btn-xs" onclick="deleteModal('{{ user.username }}', {{ user.id }})">
                                <i class="fa fa-trash-o"></i>
                            </a>
                    </tr>
                </form>
            {% endfor %}
        </table>
    </div>


    <!--Delete User confirmation modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteTitle" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 id="deleteTitle" class="modal-title"></h4>
                </div>
                <div class="modal-body">
                    <p id="deleteBody">
                        This action will remove this user and <strong>cannot</strong> be undone.
                        The next time the user logs in, their profile will be created using default settings.
                    </p>
                    <p id="deleteSelfWarning" class="text-danger">
                        You are about to delete <strong>YOUR</strong> profile and will be logged out!
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a href="" id="deleteProfileButton" type="button" class="btn btn-danger">Delete Profile</a>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block footer %}
    <script type="text/javascript">
        function deleteModal (username, user_id) {
            $('#deleteTitle').text('Delete user: \"' + username + '\" ?');
            $('#deleteProfileButton').attr('href', '/ceeq/user_delete/' + user_id);
            if (user_id == {{ current_user_id }}) {
                $('#deleteSelfWarning').show();
            } else {
                $('#deleteSelfWarning').hide();
            }
            $('#confirmModal').modal('show');
        }
    </script>
{% endblock %}